---
import Layout from "../layouts/Layout.astro";
import { ColonyCanvas } from "../components/flow/ColonyCanvas";
import { TaskFlowCanvas } from "../components/flow/TaskFlowCanvas";
import { AntColonyFlow } from "../components/flow/AntColonyFlow";
import { AntStigmergy } from "../components/flow/AntStigmergy";
import { AntNetwork } from "../components/flow/AntNetwork";
---

<Layout title="Ant Colony Envelope System">
  <div class="h-screen w-screen flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="flex-none px-6 py-3 border-b border-[#1e293b] bg-[#0f0f14]">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <h1 class="text-xl font-semibold text-white flex items-center gap-2">
            <span class="text-2xl">üêú</span>
            Ant Colony Envelope System
          </h1>
          <span class="text-xs text-slate-500 px-2 py-1 rounded bg-slate-500/10 border border-slate-500/20">
            TypeQL ‚Üí JSON ‚Üí ReactFlow
          </span>
        </div>

        <!-- View tabs -->
        <div class="flex items-center gap-1 p-1 bg-[#0a0a0f] rounded-lg border border-[#1e293b]">
          <button
            id="tab-network"
            class="tab-btn active px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2"
            data-view="network"
          >
            <span class="text-amber-400">üêú</span>
            Network
          </button>
          <button
            id="tab-stigmergy"
            class="tab-btn px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2"
            data-view="stigmergy"
          >
            <span class="text-green-400">‚ú¶</span>
            Emergence
          </button>
          <button
            id="tab-relay"
            class="tab-btn px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2"
            data-view="relay"
          >
            <span class="text-blue-400">‚öô</span>
            Relay
          </button>
          <button
            id="tab-tasks"
            class="tab-btn px-4 py-1.5 text-sm font-medium rounded-md transition-all flex items-center gap-2"
            data-view="tasks"
          >
            <span class="text-purple-400">‚úì</span>
            Tasks
          </button>
        </div>
      </div>
    </header>

    <!-- Main content area -->
    <main class="flex-1 relative overflow-hidden">
      <!-- Network view (default) - Ants ARE nodes, passing envelopes -->
      <div id="view-network" class="view-panel absolute inset-0">
        <AntNetwork client:load />
      </div>

      <!-- Stigmergy view - Watch emergence from chaos -->
      <div id="view-stigmergy" class="view-panel absolute inset-0 hidden">
        <AntStigmergy client:load />
      </div>

      <!-- Relay view - Task stations with ants -->
      <div id="view-relay" class="view-panel absolute inset-0 hidden">
        <AntColonyFlow client:load />
      </div>

      <!-- Tasks view - Project tasks with dependencies -->
      <div id="view-tasks" class="view-panel absolute inset-0 hidden">
        <TaskFlowCanvas client:load />
      </div>
    </main>

    <!-- Footer -->
    <footer class="flex-none px-6 py-2 border-t border-[#1e293b] bg-[#0f0f14]">
      <div class="flex items-center justify-between text-[10px] text-slate-500">
        <div class="flex items-center gap-4">
          <span class="text-amber-400/70">üêú Ants = Nodes</span>
          <span class="text-slate-600">|</span>
          <span>üì¶ Envelopes flow along pheromone edges</span>
          <span class="text-slate-600">|</span>
          <span>üîÑ Loops create cyclic processing</span>
          <span class="text-slate-600">|</span>
          <span class="text-amber-400/70">üõ£Ô∏è Superhighways emerge</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-amber-500 animate-pulse"></span>
          <span class="text-amber-400/70">Stigmergic Network</span>
        </div>
      </div>
    </footer>
  </div>
</Layout>

<style is:global>
  .react-flow__attribution { display: none !important; }
  .react-flow__panel { margin: 16px; }

  @keyframes pulse-subtle {
    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1); }
  }

  .animate-pulse-subtle { animation: pulse-subtle 2s ease-in-out infinite; }
  .react-flow__edge-textwrapper { pointer-events: none; }

  .tab-btn { color: #64748b; }
  .tab-btn:hover { color: #94a3b8; background-color: rgba(30, 41, 59, 0.5); }
  .tab-btn.active { color: #fff; background-color: #1e293b; }

  input[type="range"] {
    -webkit-appearance: none;
    height: 4px;
    background: #1e293b;
    border-radius: 2px;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    background: #3b82f6;
    border-radius: 50%;
    cursor: pointer;
  }
</style>

<script>
  const tabs = document.querySelectorAll('.tab-btn');
  const views = document.querySelectorAll('.view-panel');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const viewName = tab.getAttribute('data-view');
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      views.forEach(view => {
        view.id === `view-${viewName}` ? view.classList.remove('hidden') : view.classList.add('hidden');
      });
      window.dispatchEvent(new Event('resize'));
    });
  });
</script>
